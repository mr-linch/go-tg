package {{.Package}}

// Code generated by go-tg/gen. DO NOT EDIT.

import (
{{- if .NeedFmt}}
	"fmt"
{{- end}}
{{- if .NeedJSON}}
	"encoding/json"
{{- end}}
)
{{range .Types}}
// {{.Comment}}
type {{.Name}} struct {
{{- range .Fields}}
	// {{.Comment}}
	{{.Name}} {{.Type}} {{.JSONTag}}
{{end -}}
}
{{end}}
{{- range .UnionTypes}}
// {{.Comment}}
type {{.Name}} struct {
{{- range .Variants}}
	{{.FieldName}} *{{.TypeName}}
{{- end}}
}

func (u *{{.Name}}) UnmarshalJSON(data []byte) error {
	var partial struct {
		D string `json:"{{.Discriminator}}"`
	}
	if err := json.Unmarshal(data, &partial); err != nil {
		return fmt.Errorf("unmarshal {{.Name}}: %w", err)
	}
	switch partial.D {
{{- range .Variants}}
	case "{{.ConstVal}}":
		u.{{.FieldName}} = &{{.TypeName}}{}
		return json.Unmarshal(data, u.{{.FieldName}})
{{- end}}
	default:
		return fmt.Errorf("unknown {{.Name}} {{.Discriminator}}: %s", partial.D)
	}
}
{{end}}
